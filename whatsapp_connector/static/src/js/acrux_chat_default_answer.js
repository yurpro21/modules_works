odoo.define("whatsapp_connector.default_answer",(function(require){"use strict";var Widget=require("web.Widget"),_t=require("web.core")._t,DefaultAnswer=Widget.extend({template:"acrux_chat_default_answer",events:{"click .o_acrux_chat_default_answer_send":"sendAnswer"},init:function(parent,options){this._super.apply(this,arguments),this.parent=parent,this.options=_.extend({},options),this.context=_.extend({},this.parent.context||{},this.options.context),this.name=this.options.name||"",this.sequence=this.options.sequence||"",this.id=this.options.id||"",this.text=this.options.text||"",this.ttype=this.options.ttype||"",this.res_model=this.options.res_model,this.res_id=this.options.res_id,this.buttons=this.options.button_ids||[],this.chat_list_id=this.options.chat_list_id||[null,""],this.env=this.parent.env},sendAnswer:async function(event){event&&(event.preventDefault(),event.stopPropagation(),$(event.target).prop("disabled",!0));let out=Promise.resolve();if(this.parent.selected_conversation&&this.parent.selected_conversation.isMine()){let text,ttype=this.ttype;"code"==this.ttype?(ttype="text",text=await this._rpc({model:"acrux.chat.default.answer",method:"eval_answer",args:[[this.id],this.parent.selected_conversation.id],context:this.context})):text=this.text&&""!=this.text?this.text:this.name;const options={from_me:!0,text,ttype,res_model:this.res_model,res_id:this.res_id,button_ids:this.buttons.map((btn=>{const btn2={...btn};return delete btn2.id,btn2})),chat_list_id:this.chat_list_id};out=this.parent.selected_conversation.createMessage(options),out.then((()=>this.parent.showConversationPanel())),out.then((()=>this.parent.showChatPanel()))}else this.env.services.crash_manager.show_warning({message:_t("You must select a conversation.")});return out.finally((()=>{event&&$(event.target).prop("disabled",!1)}))}});return DefaultAnswer}));