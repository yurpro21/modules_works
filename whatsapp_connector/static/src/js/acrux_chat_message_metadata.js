odoo.define("whatsapp_connector.message_metadata",(function(require){"use strict";const Widget=require("web.Widget"),session=require("web.session"),AudioPlayer=require("whatsapp_connector.audio_player"),MessageMetadata=Widget.extend({template:"acrux_chat_message_metadata",events:{"click .o_acrux_chat_message_metadata":"openExternalLink"},init:function(parent,options){this._super.apply(this,arguments),this.parent=parent,this.options=_.extend({},options),this.context=_.extend({},this.parent.context||{},this.options.context),this.type=options.metadata_type,this.data=JSON.parse(options.metadata_json),this.data.title=this.data.title||"",this.data.body=this.data.body||""},start:function(){return this._super().then((()=>{const out=[];return"audio"===this.data?.media?.type&&this.data?.media?.url&&out.push(this.audioController()),Promise.all(out)}))},audioController:function(){this.audioPlayerWidget&&this.audioPlayerWidget.destroy();let options={context:this.context,src:this.data.media.url};return this.audioPlayerWidget=new AudioPlayer(this,options),this.$(".acrux_metadata_media").addClass("status_audio"),this.audioPlayerWidget.appendTo(this.$(".acrux_metadata_media"))},openExternalLink:function(){this.data.url&&window.open(session.url(this.data.url),"_blank")}});return MessageMetadata}));