odoo.define("whatsapp_connector.user_status",(function(require){"use strict";var core=require("web.core"),Widget=require("web.Widget"),session=require("web.session"),_t=core._t,UserStatus=Widget.extend({template:"acrux_chat_user_status",events:{"click label#chat_status_active":"changeStatus","click label#chat_status_inactive":"changeStatus","click .acrux_simple_create_new_conv":"openSimpleNewConversation","click .acrux_order_current_conversation":"reorderConversations"},init:function(parent,options){this._super.apply(this,arguments),this.parent=parent,this.options=_.extend({},options),this.context=_.extend({},this.parent.context||{},this.options.context),this.acrux_chat_active=this.options.acrux_chat_active,this.conversationOrder=this.parent.conversationOrder},willStart:function(){return Promise.all([this._super(),this.getUserStatus()])},start:function(){return this._super().then((()=>this._initRender()))},_initRender:function(){return this.$lables_status=this.$("label#chat_status_active, label#chat_status_inactive"),this.acrux_chat_active?this.$("label#chat_status_active").addClass("active"):this.$("label#chat_status_inactive").addClass("active"),Promise.resolve()},getUserStatus:function(){return this._rpc({model:"res.users",method:"read",args:[[session.uid],["acrux_chat_active"]],context:this.context}).then((result=>{this.acrux_chat_active=result[0].acrux_chat_active}))},changeStatus:function(event){let toggle=!1;"chat_status_active"==$(event.target).prop("id")?this.acrux_chat_active||(toggle=!0):this.acrux_chat_active&&(toggle=!0),toggle&&(this.$lables_status.toggleClass("active"),this.acrux_chat_active=!this.acrux_chat_active,this._rpc({model:"res.users",method:"set_chat_active",args:[[session.uid],{acrux_chat_active:this.acrux_chat_active}],context:this.context}))},changeStatusNotify:function(data){this.acrux_chat_active!=data.status&&this.$lables_status.toggleClass("active"),this.acrux_chat_active=data.status},isActive:function(){return this.acrux_chat_active},openSimpleNewConversation:function(){let action={type:"ir.actions.act_window",name:_t("Search"),view_type:"form",view_mode:"form",res_model:"acrux.chat.simple.new.conversation.wizard",views:[[!1,"form"]],target:"new",context:this.context};this.do_action(action)},reorderConversations:function(event){return this.parent.reorderConversations(event)}});return UserStatus}));